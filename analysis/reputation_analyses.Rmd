---
title: "reputation_analyses"
author: ""
date: ""
urlcolor: blue # to show hyperlinks in blue when printed as pdf

# uncomment below to render to html
# output:
#   bookdown::html_document2:
#     toc: true
#     toc_depth: 4
#     theme: cosmo
#     highlight: tango
    
output:
  bookdown::pdf_book:
    toc: true
    toc_depth: 4
    highlight: tango
    includes:
      in_header: my_header.tex
    
bibliography: [references/packages.bib]
biblio-style: apalike
nocite: '@*'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE, messages = FALSE}
library("knitr") # for knitting markdown file
library("broom")
library("plotrix")
library("aod")
library("prevalence")
library("extrafont")
library("grid")
library("kableExtra")
library("rcompanion")
library("ggeffects") # for generating model predictions
library("MASS")
library("lmtest")
library("geepack")
library("tidyverse") # tidyverse
library("dplyr")
```

```{r, include=F}
# set ggplot theme
theme_set(theme_classic())
```

```{r, include=F}
# include references for used packages
knitr::write_bib(.packages(), "references/packages.bib") 
```

# Study 1 - Who Lied about their Poor Performance?

```{r, message = F}
# read in data
lap_data = read_csv("../data/study1_lying_about_poor_perf/data_study1.csv")
```

```{r}
# data cleaning
lap_data = lap_data %>% 
  mutate(Script = as.factor(Script)) %>% 
  mutate(Sex = ifelse(Sex == "0", 
                      "female", 
                      "male"),
         WhoLied = ifelse(WhoLied == "0", 
                          "Intrinsic", 
                          "Reputational")) %>% # recode data
  mutate(AgeGroup = ifelse((Age_Yrs == 4|Age_Yrs == 5), "4-5", 
                           ifelse((Age_Yrs == 6|Age_Yrs == 7), "6-7",
                           ifelse((Age_Yrs == 8|Age_Yrs ==9), "8-9", NA)))) %>%  
    mutate(AgeGroup = as.factor(AgeGroup)) %>% 
    mutate(WhoLied = as.factor(as.character(WhoLied))) %>% 
    mutate(Sex = as.factor(as.character(Sex)))
```

## Summary

```{r}
 # generates table with percentage breakdown of children who identified either 
# the reputational or intrinsic character as the one who lied about their poor performance
lap_summary = lap_data %>%
  group_by(AgeGroup) %>%
  summarise(percent_intrinsic = (sum(WhoLied == "Intrinsic")/length(Sub_ID))*100,
            number_intrinsic = (sum(WhoLied == "Intrinsic")),
            percent_reputational = (sum(WhoLied == "Reputational")/length(Sub_ID))*100,
            number_reputational = (sum(WhoLied == "Reputational")),
            total_n = (sum(WhoLied == "Intrinsic"|WhoLied == "Reputational")))

# generate table
lap_summary %>% 
  kable(caption = "Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Demographics

```{r}
# gender
# create dataframe with percentage breakdown for gender of participants
lap_gender_summary = lap_data %>% 
  group_by(AgeGroup, Sex) %>% 
  summarise(n = length(Sub_ID)) %>% 
              mutate(percentage = (n / sum(n))*100) 

# generate table
lap_gender_summary %>% 
  kable(caption = "Gender Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

```{r}
# age
# create dataframe with summary stats (mean and SD) for age of participants
lap_age_summary <- lap_data %>% 
  group_by(AgeGroup) %>% 
  summarise(mean_age = mean(Age_Ex),
            SD_age = sd(Age_Ex)) 

# generate table
lap_age_summary %>% 
  kable(caption = "Age Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Primary Analyses

```{r}
# generates logistic regression model examining the effect of age (entered as a continuous 
# predictor) on whether children identified the character with 
# reputational or intrinsic concerns as the one who would lie about their poor performance
lap_logit_model = glm(WhoLied ~ Age_Ex, 
                       data = lap_data, 
                       family = binomial(link = "logit")) 
```

```{r}
lap_logit_compact_model = glm(WhoLied ~ 1, 
                       data = lap_data, 
                       family = binomial(link = "logit")) 
```

```{r}
anova(lap_logit_compact_model,
      lap_logit_model,
          test = "Chisq")
```

```{r}
# generates summary of logistic regression model
summary(lap_logit_model) 
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_model), confint.default(lap_logit_model, level = 0.95)))
```

```{r}
nagelkerke(lap_logit_model)
```

```{r}
logLik(lap_logit_model)
```

```{r}
# computes Wald chi-square value for main effect of age
lap_wald_test = wald.test(b = coef(lap_logit_model),
                           Sigma = vcov(lap_logit_model), 
                           Terms = 2, 
                           verbose = TRUE) 

# prints results of Wald chi-square test
print(lap_wald_test, digits = 5) 
```

```{r}
newdata = data.frame(Age_Ex = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = lap_logit_model,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$Age_Ex)[newdata$Age_Ex]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

# Study 2 - Who Lied about their Successful Performance?

```{r, message=F}
# read in data
las_data = read_csv("../data/study2_lying_about_good_perf/data_study2.csv")
```

```{r}
# data cleaning
las_data = las_data %>% 
  mutate(Script = as.factor(Script)) %>% 
  mutate(Sex = ifelse(Sex == "0", "female", "male"),
         WhoLied = ifelse(WhoLied == "0", "Reputational", "Intrinsic")) %>% # recode data
  mutate(AgeGroup = ifelse((Age_Yrs == 4|Age_Yrs == 5), "4-5", 
                           ifelse((Age_Yrs == 6|Age_Yrs == 7), "6-7",
                           ifelse((Age_Yrs == 8|Age_Yrs ==9), "8-9", NA)))) %>%  
    mutate(AgeGroup = as.factor(AgeGroup)) %>% 
    mutate(WhoLied = as.factor(as.character(WhoLied))) %>% 
    mutate(Sex = as.factor(as.character(Sex)))
```

## Summary

```{r}
# generates table with percentage breakdown of children who identified either the 
# reputational or intrinsic character as the one who lied about their poor performance
las_summary = las_data %>%
  group_by(AgeGroup) %>%
  summarise(percent_intrinsic = (sum(WhoLied == "Intrinsic")/length(Sub_ID))*100,
            number_intrinsic = (sum(WhoLied == "Intrinsic")),
            percent_reputational = (sum(WhoLied == "Reputational")/length(Sub_ID))*100,
            number_reputational = (sum(WhoLied == "Reputational")),
            total_n = (sum(WhoLied == "Intrinsic"|WhoLied == "Reputational"))) 

# generate table
las_summary %>% 
  kable(caption = "Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Demographics

```{r}
# gender
# creates dataframe with percentage breakdown for gender of participants
las_gender_summary = las_data %>% 
  group_by(AgeGroup, Sex) %>% 
  summarise(n = length(Sub_ID)) %>% 
              mutate(percentage = (n / sum(n))*100) 

# generates table
las_gender_summary %>% 
  kable(caption = "Gender Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

```{r, fig.pos='H'}
# age
# creates dataframe with summary stats (mean and SD) for age of participants
las_age_summary = las_data %>% 
  group_by(AgeGroup) %>% 
  summarise(mean_age = mean(Age_Ex),
            SD_age = sd(Age_Ex)) 

# generates table
las_age_summary %>% 
  kable(caption = "Age Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Primary Analyses

```{r}
# generates logistic regression model examining the effect of age (entered as a continuous 
# predictor) on whether children identified the character with 
# reputational or intrinsic concerns as the one who would lie about their poor performance
las_logit_model = glm(WhoLied ~ Age_Ex, 
                       data = las_data, 
                       family = binomial(link = "logit"))

 # generates summary of logistic regression model
summary(las_logit_model)
```

```{r}
las_logit_compact_model = glm(WhoLied ~ 1, 
                       data = las_data, 
                       family = binomial(link = "logit"))
```

```{r}
anova(las_logit_compact_model,
      las_logit_model,
          test = "Chisq")
```

```{r}
nagelkerke(las_logit_model)
```

```{r}
logLik(las_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(las_logit_model), confint.default(las_logit_model, level = 0.95)))
```

```{r}
# computes Wald chi-square value for logistic regression model described above 
las_wald_test = wald.test(b = coef(las_logit_model),
                           Sigma = vcov(las_logit_model), 
                           Terms = 2, 
                           verbose = TRUE) 

# prints results of Wald chi-square test
print(las_wald_test, digits = 5) 
```

```{r}
newdata = data.frame(Age_Ex = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = las_logit_model,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$Age_Ex)[newdata$Age_Ex]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

# Study 3 - Who Sought Help Publicly?

```{r, message=F}
# read in data
psh_data = read_csv("../data/study3_public_help_seeking/data_study3.csv")
```

```{r}
# data cleaning
psh_data = psh_data %>% 
  mutate(Script = as.factor(Script)) %>% 
  mutate(Sex = ifelse(Sex == "0", 
                      "female", 
                      "male"),
         WhoAsked = ifelse(WhoAsked == "0", 
                           "Reputational", 
                           "Intrinsic")) %>% # recode data
  mutate(AgeGroup = ifelse((Age_Yrs == 4|Age_Yrs == 5), "4-5", 
                           ifelse((Age_Yrs == 6|Age_Yrs == 7), "6-7",
                           ifelse((Age_Yrs == 8|Age_Yrs == 9), "8-9", NA)))) %>%  
    mutate(AgeGroup = as.factor(AgeGroup)) %>% 
    mutate(WhoAsked = as.factor(as.character(WhoAsked))) %>% 
    mutate(Sex = as.factor(as.character(Sex)))
```

## Summary

```{r}
# generates table with percentage breakdown of children who identified either the 
# reputational or intrinsic character as the one who publicly sought help
psh_summary = psh_data %>%
  group_by(AgeGroup) %>%
  summarise(percent_intrinsic = (sum(WhoAsked == "Intrinsic")/length(Sub_ID))*100,
            number_intrinsic = (sum(WhoAsked == "Intrinsic")),
            percent_reputational = (sum(WhoAsked == "Reputational")/length(Sub_ID))*100,
            number_reputational = (sum(WhoAsked == "Reputational")),
            total_n = (sum(WhoAsked == "Intrinsic"|WhoAsked == "Reputational"))) 

# generates table
psh_summary %>% 
  kable(caption = "Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Demographics 

```{r}
# gender
# creates dataframe with percentage breakdown for gender of participants
psh_gender_summary = psh_data %>% 
  group_by(AgeGroup, Sex) %>% 
  summarise(n = length(Sub_ID)) %>% 
              mutate(percentage = (n / sum(n))*100) 

# generates table
psh_gender_summary %>% 
  kable(caption = "Gender Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

```{r}
# age
# creates dataframe with summary stats (mean and SD) for age of participants
psh_age_summary = psh_data %>% 
  group_by(AgeGroup) %>% 
  summarise(mean_age = mean(Age_Ex),
            SD_age = sd(Age_Ex)) 

# generates table
psh_age_summary %>% 
  kable(caption = "Age Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Primary Analyses

```{r}
# generates logistic regression model examining the effect of age (entered as a continuous 
# predictor) on whether children identified the character with 
# reputational or intrinsic concerns as the one who would publicly seek help
psh_logit_model = glm(WhoAsked ~ Age_Ex, 
                              data = psh_data, 
                              family = binomial(link = "logit")) 

# generates summary of logistic regression model
summary(psh_logit_model) 
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(psh_logit_model), confint.default(psh_logit_model, level = 0.95)))
```

```{r}
psh_logit_compact_model = glm(WhoAsked ~ 1, 
                              data = psh_data, 
                              family = binomial(link = "logit")) 
```

```{r}
anova(psh_logit_compact_model,
      psh_logit_model,
          test = "Chisq")
```

```{r}
nagelkerke(psh_logit_model)
```

```{r}
logLik(psh_logit_model)
```

```{r}
# computes Wald chi-square value for logistic regression model described above 
psh_wald_test = wald.test(b = coef(psh_logit_model), 
                                  Sigma = vcov(psh_logit_model), Terms = 2, 
                                  verbose = TRUE) 

 # prints results of Wald chi-square test
print(psh_wald_test, digits = 4)
```

```{r}
newdata = data.frame(Age_Ex = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = psh_logit_model,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$Age_Ex)[newdata$Age_Ex]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

# Study 4 - Who Sought Help Publicly versus Privately?

```{r, message=F}
# read in data
pvp_data = read_csv("../data/study4_public_vs_private/data_study4.csv") 
```

```{r}
# data cleaning
pvp_data = pvp_data %>% 
  mutate(Sex = as.factor(Sex)) %>% 
  mutate(Condition = ifelse(Condition == "1", 
                            "private", 
                            "public"),
         Sex = ifelse(Sex == "0", 
                      "female", 
                      "male"),
         SoughtHelp = ifelse(SoughtHelp == "0", 
                             "Reputational", 
                             "Intrinsic")) %>% # recode data
  mutate(AgeGroup = ifelse((Age_Yrs == 4|Age_Yrs == 5), "4-5", 
                           ifelse((Age_Yrs == 6|Age_Yrs == 7), "6-7",
                           ifelse((Age_Yrs == 8|Age_Yrs ==9), "8-9", NA)))) %>%  
    mutate(AgeGroup = as.factor(AgeGroup)) %>% 
    mutate(SoughtHelp = as.factor(as.character(SoughtHelp)),
           Condition = as.factor(as.character(Condition)))
```

```{r}
# create dataframe with data from private condition ONLY
study4_private_data = pvp_data %>% 
  filter(Condition == "private")

# create dataframe with data from public condition ONLY
study4_public_data = pvp_data %>% 
  filter(Condition == "public") 
```

```{r}
# recoding data such that 'intrinsic' is 0 and 'reputational' is 1 &
# private condition is 0 and public condition is 1
recoded_pvp_data = pvp_data %>% 
  mutate(Condition = ifelse(Condition == "private", 
                            "0", 
                            "1"),
         SoughtHelp = ifelse(SoughtHelp == "Intrinsic", 
                             "0", 
                             "1")) %>% 
  mutate(Condition = factor(Condition, levels = c(0, 1)),
         SoughtHelp = factor(SoughtHelp, levels = c(0,1))) 
```


## Summary

```{r}
# generates table with percentage breakdown of children who identified either the 
# reputational or intrinsic character as the one who sought help
pvp_summary = pvp_data %>%
  group_by(Condition, AgeGroup) %>%
  summarise(percent_intrinsic = (sum(SoughtHelp == "Intrinsic")/length(Sub_ID))*100,
            number_intrinsic = (sum(SoughtHelp == "Intrinsic")),
            percent_reputational = (sum(SoughtHelp == "Reputational")/length(Sub_ID))*100,
            number_reputational = (sum(SoughtHelp == "Reputational")),
            total_n = (sum(SoughtHelp == "Intrinsic"|SoughtHelp == "Reputational")))

# generates table
pvp_summary %>% 
  kable(caption = "Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = c("hold_position", "scale_down"))
```

## Demographics

```{r}
# gender
# creates dataframe with percentage breakdown for gender of participants
pvp_gender_summary = pvp_data %>% 
  group_by(Condition, AgeGroup, Sex) %>% 
  summarise(n = length(Sub_ID)) %>% 
              mutate(percentage = (n / sum(n))*100) 

 # generates table
pvp_gender_summary %>% 
  kable(caption = "Gender Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

```{r}
# age
# creates dataframe with summary stats (mean and SD) for age of participants
pvp_age_summary <- pvp_data %>% 
  group_by(Condition, AgeGroup) %>% 
  summarise(mean_age = mean(Age_Ex),
            SD_age = sd(Age_Ex)) 

# generates table
pvp_age_summary %>% 
  kable(caption = "Age Summary") %>% 
  kable_styling(bootstrap_options = "striped",
                full_width = F,
                latex_options = "hold_position")
```

## Primary Analyses

### Examining interaction between condition and age

```{r}
# generates logistic regression model examining the effect of age (entered as a continuous 
# predictor) and the effect of condition (entered as a categorical predictor) on whether 
# children identified the character with reputational or intrinsic concerns as
# the one who would seek help
pvp_logit_model = glm(formula = SoughtHelp ~ Age_Ex * factor(Condition), 
                              data = recoded_pvp_data, 
                              family = "binomial") 

pvp_logit_model_compact = glm(formula = SoughtHelp ~ 1, 
                              data = recoded_pvp_data, 
                              family = "binomial") 

# prints summary of above logit model
summary(pvp_logit_model) 
```

```{r}
anova(pvp_logit_model_compact,
      pvp_logit_model,
      test = "Chisq")
```

```{r}
nagelkerke(pvp_logit_model)
```

```{r}
logLik(pvp_logit_model)
```

```{r}
# computes Wald chi-square value for main effect of age
pvp_wald_test_age_main_effect = wald.test(b=coef(pvp_logit_model),
                                                  Sigma = vcov(pvp_logit_model), 
                                                  Terms = 2, 
                                                  verbose = TRUE) 

# prints output of Wald test described above
print(pvp_wald_test_age_main_effect, digits = 5) 
```

```{r}
# computes Wald chi-square value for main effect of Condition
pvp_wald_test_condition_main_effect <- wald.test(b=coef(pvp_logit_model),
                                                 Sigma = vcov(pvp_logit_model), 
                                                 Terms = 3, 
                                                 verbose = TRUE) 

 # prints Wald test described above
print(pvp_wald_test_condition_main_effect, digits = 5)
```

```{r}
# computes Wald chi-square value for interaction between age and condition
pvp_wald_test_interaction = wald.test(b = coef(pvp_logit_model),
                                                     Sigma = vcov(pvp_logit_model), 
                                                     Terms = 4, 
                                                     verbose = TRUE) 

# prints Wald test described above
print(pvp_wald_test_interaction, digits = 5) 
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_logit_model), confint.default(pvp_logit_model, level = 0.95)))
```

### Examining effect of age within private condition

```{r}
# generates logistic regression model examining the effect of age (entered as a continuous 
# predictor) on whether children identified the character with 
# reputational or intrinsic concerns as the one who would privately seek help
study4_private_logit_model = glm(SoughtHelp ~ Age_Ex, 
                                  data = study4_private_data, 
                                  family = binomial(link = "logit")) 

# generates summary of logistic regression model
summary(study4_private_logit_model) 
```

```{r}
study4_private_logit_compact_model = glm(SoughtHelp ~ 1, 
                                  data = study4_private_data, 
                                  family = binomial(link = "logit")) 
```

```{r}
anova(study4_private_logit_compact_model,
      study4_private_logit_model,
      test = "Chisq")
```

```{r}
nagelkerke(study4_private_logit_model)
```

```{r}
logLik(study4_private_logit_model)
```

```{r}
# computes Wald chi-square value for logistic regression model described above 
study4_private_wald_test = wald.test(b = coef(study4_private_logit_model),
                                     Sigma = vcov(study4_private_logit_model), 
                                     Terms = 2, 
                                     verbose = TRUE) 

# prints results of Wald chi-square test
print(study4_private_wald_test, digits = 5)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(study4_private_logit_model), confint.default(study4_private_logit_model, level = 0.95)))
```


```{r}
newdata = data.frame(Age_Ex = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = study4_private_logit_model,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$Age_Ex)[newdata$Age_Ex]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

### Examining effect of age within public condition

```{r}
# generates logistic regression model examining the effect of age (entered as a continuous 
# predictor) on whether children identified the character with 
# reputational or intrinsic concerns as the one who would publicly seek help
study4_public_logit_model = glm(SoughtHelp ~ Age_Ex, 
                                 data = study4_public_data, 
                                 family = binomial(link = "logit")) 

# generates summary of logistic regression model
summary(study4_public_logit_model) 
```

```{r}
study4_public_logit_compact_model = glm(SoughtHelp ~ 1, 
                                 data = study4_public_data, 
                                 family = binomial(link = "logit")) 
```

```{r}
anova(study4_public_logit_compact_model,
      study4_public_logit_model,
      test = "Chisq")
```

```{r}
nagelkerke(study4_public_logit_model)
```

```{r}
logLik(study4_public_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(study4_public_logit_model), confint.default(study4_public_logit_model, level = 0.95)))
```

```{r}
# computes Wald chi-square value for logistic regression model described above 
study4_public_wald_test = wald.test(b=coef(study4_public_logit_model),
                                     Sigma = vcov(study4_public_logit_model), 
                                     Terms = 2, 
                                     verbose = TRUE) 

 # prints results of Wald chi-square test
print(study4_public_wald_test, digits = 5)
```

```{r}
newdata = data.frame(Age_Ex = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = study4_public_logit_model,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$Age_Ex)[newdata$Age_Ex]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

# Study 5 - Examining Children's Inferences in a Non-School Context

```{r}
study5_data = read_csv("../data/study5_non_school_context/data_study5.csv") %>% 
  mutate(age_group = ifelse((child_age_yrs == 4|child_age_yrs == 5), "4-5", 
                            ifelse((child_age_yrs == 6|child_age_yrs == 7), "6-7",
                                   ifelse((child_age_yrs == 8|child_age_yrs == 9), "8-9", NA)))) %>% 
  mutate(age_group = as.factor(age_group)) %>% 
  mutate(composite_score = as.factor(composite_score)) %>% 
  mutate(like_better = factor(like_better,
                              levels = c("Reputational",
                                         "Intrinsic"),
                              labels = c("Reputational",
                                         "Intrinsic"))) %>% 
  mutate(lap = factor(lap,
                      levels = c("Intrinsic",
                                 "Reputational"),
                      labels = c("Intrinsic",
                                 "Reputational"))) %>% 
  mutate(lah = factor(lah,
                      levels = c("Intrinsic",
                                 "Reputational"),
                      labels = c("Intrinsic",
                                 "Reputational"))) %>% 
  mutate(across(.cols = starts_with("comp_check"),
                ~factor(.,
                        levels = c("Incorrect",
                                   "Correct"),
                        labels = c("Incorrect",
                                   "Correct")))) %>% 
  mutate(child_gender = factor(child_gender,
                               levels = c("Male",
                                          "Female"),
                               labels = c("Male",
                                          "Female")))
```

## Summary

```{r}
# response breakdown (Q1 - liking measure)
study5_summary_liking = study5_data %>%
  group_by(age_group) %>%
  summarise(percent_intrinsic = (sum(like_better == "Intrinsic")/length(new_ID))*100,
            number_intrinsic = (sum(like_better == "Intrinsic")),
            percent_reputational = (sum(like_better == "Reputational")/length(new_ID))*100,
            number_reputational = (sum(like_better == "Reputational")),
            total_n = (sum(like_better == "Intrinsic"|like_better == "Reputational"))) 

study5_summary_liking %>% 
  kable(caption = "Who do you like better?") # generates table
```

```{r}
# response breakdown (Q2 - lying about performance measure)
study5_summary_lap = study5_data %>%
  group_by(age_group) %>%
  summarise(percent_intrinsic = (sum(lap == "Intrinsic")/length(new_ID))*100,
            number_intrinsic = (sum(lap == "Intrinsic")),
            percent_reputational = (sum(lap == "Reputational")/length(new_ID))*100,
            number_reputational = (sum(lap == "Reputational")),
            total_n = (sum(lap == "Intrinsic"|lap == "Reputational"))) 

study5_summary_lap %>% 
  kable(caption = "Who do you think lied about doing poorly at the game?") # generates table
```

```{r}
# response breakdown (Q3 - lying about helping measure)
study5_summary_lah = study5_data %>%
  group_by(age_group) %>%
  summarise(percent_intrinsic = (sum(lah == "Intrinsic")/length(new_ID))*100,
            number_intrinsic = (sum(lah == "Intrinsic")),
            percent_reputational = (sum(lah == "Reputational")/length(new_ID))*100,
            number_reputational = (sum(lah == "Reputational")),
            total_n = (sum(lah == "Intrinsic"|lah == "Reputational"))) 

study5_summary_lah %>% 
  kable(caption = "Who do you think lied about helping?") # generates table
```

## Demographics

```{r}
# gender breakdown (by age group)
study5_gender_summary = study5_data %>% 
  group_by(age_group,
           child_gender) %>% 
  summarise(n = length(new_ID)) %>% 
  mutate(percentage = (n / sum(n))*100) 

study5_gender_summary %>% 
  kable(caption = "Gender Summary") # generates table
```

```{r}
# age breakdown 
study5_age_summary = study5_data %>%
  group_by(age_group) %>%
  summarise(mean_age = mean(exact_age),
            SD_age = sd(exact_age))

study5_age_summary %>%
  kable(caption = "Mean Age (by Age Group)")
```

## Primary Analyses

### Logistic GEE Model

```{r}
# long format data for study 5
df.long_study_5 = study5_data %>% 
  mutate(like_better = ifelse(like_better == "Intrinsic",
                              1,
                              0)) %>% 
  mutate(lap = ifelse(lap == "Reputational",
                              1,
                              0)) %>% 
  mutate(lah = ifelse(lah == "Reputational",
                              1,
                              0)) %>% 
  pivot_longer(cols = c(like_better,
                        lap,
                        lah),
               names_to = "Measure",
               values_to = "Response")
```

```{r}
gee_augmented_model = geeglm(formula = Response ~ exact_age*Measure,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

summary(gee_augmented_model)
```

```{r}
gee_model = geeglm(formula = Response ~ exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

summary(gee_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(gee_model), confint.default(gee_model, level = 0.95)))
```

### Liking Measure

```{r}
df.liking_recoded = study5_data %>% 
  mutate(like_better = relevel(like_better,
                               ref = "Intrinsic"))
```

```{r}
# generates logistic regression model to examine the effect of age on children's
# social preference for the reputationally or intrinsically motivated character
liking_model_aug_age_ex = glm(like_better ~ exact_age, 
                                  data = df.liking_recoded, 
                                  family = binomial(link = "logit"))

summary(liking_model_aug_age_ex)
```

```{r}
liking_model_compact_age_ex = glm(like_better ~ 1, 
                                  data = df.liking_recoded, 
                                  family = binomial(link = "logit"))
```

```{r}
anova(liking_model_compact_age_ex,
      liking_model_aug_age_ex,
      test = "Chisq")
```

```{r}
nagelkerke(liking_model_aug_age_ex)
```

```{r}
logLik(liking_model_aug_age_ex)
```

```{r}
# generates Wald chi square statistic for effect of age 
liking_wald_test_age_ex = wald.test(b = coef(liking_model_aug_age_ex),
                                      Sigma = vcov(liking_model_aug_age_ex), 
                                      Terms = 2, 
                                      verbose = TRUE) 

print(liking_wald_test_age_ex, digits = 4) 
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_model_aug_age_ex), confint.default(liking_model_aug_age_ex, level = 0.95)))
```

```{r}
# predicted probabilities at 0.1-year increments
newdata = data.frame(exact_age = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = liking_model_aug_age_ex,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$exact_age)[newdata$exact_age]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

### Lying about Performance Measure

```{r}
# generates logistic regression model to examine the effect of age on children's
# choice of the reputationally or intrinsically motivated character as the one
# who lied about performing poorly at a game
lap_model_aug_age_ex = glm(lap ~ exact_age, 
                                  data = study5_data, 
                                  family = binomial(link = "logit"))
```

```{r}
lap_model_compact_age_ex = glm(lap ~ 1, 
                                  data = study5_data, 
                                  family = binomial(link = "logit"))
```

```{r}
anova(lap_model_compact_age_ex,
      lap_model_aug_age_ex,
      test = "Chisq")
```

```{r}
nagelkerke(lap_model_aug_age_ex)
```

```{r}
logLik(lap_model_aug_age_ex)
```

```{r}
# generates Wald chi square statistic for effect of age
lap_wald_test_age_ex = wald.test(b = coef(lap_model_aug_age_ex),
                                      Sigma = vcov(lap_model_aug_age_ex), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(lap_wald_test_age_ex, digits = 4)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_model_aug_age_ex), confint.default(lap_model_aug_age_ex, level = 0.95)))
```

```{r}
# predicted probabilities at 0.1-year increments
newdata = data.frame(exact_age = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = lap_model_aug_age_ex,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$exact_age)[newdata$exact_age]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

### Lying about Helping Measure

```{r}
# generates logistic regression model to examine the effect of age on children's
# choice of the reputationally or intrinsically motivated character as the one
# who lied about having helped at the playground
lah_model_aug_age_ex = glm(lah ~ exact_age, 
                                  data = study5_data, 
                                  family = binomial(link = "logit"))

summary(lah_model_aug_age_ex)
```

```{r}
lah_model_compact_age_ex = glm(lah ~ 1, 
                                  data = study5_data, 
                                  family = binomial(link = "logit"))
```

```{r}
anova(lah_model_compact_age_ex,
      lah_model_aug_age_ex,
      test = "Chisq")
```

```{r}
nagelkerke(lah_model_aug_age_ex)
```

```{r}
logLik(lah_model_aug_age_ex)
```

```{r}
# generates Wald chi square statistic for effect of age
lah_wald_test_age_ex = wald.test(b = coef(lah_model_aug_age_ex),
                                      Sigma = vcov(lah_model_aug_age_ex), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(lah_wald_test_age_ex, digits = 4)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_model_aug_age_ex), confint.default(lah_model_aug_age_ex, level = 0.95)))
```

```{r}
# predicted probabilities at 0.1-year increments
newdata = data.frame(exact_age = c(4.0, 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8, 4.9, 
                                   5.0, 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7, 5.8, 5.9,
                                   6.0, 6.1, 6.2, 6.3, 6.4, 6.5, 6.6, 6.7, 6.8, 6.9,
                                   7.0, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8, 7.9,
                                   8.0, 8.1, 8.2, 8.3, 8.4, 8.5, 8.6, 8.7, 8.8, 8.9,
                                   9.0, 9.1, 9.2, 9.3, 9.4, 9.5, 9.6, 9.7, 9.8, 9.9))

p = predict(object = lah_model_aug_age_ex,
             newdata = newdata,
             type = "response",
             se.fit = TRUE)

mult <- qnorm(0.5*(1-0.95))

out <- cbind(p$fit,
             p$se.fit,
             p$fit+p$se.fit*mult,
             p$fit-p$se.fit*mult)

rownames(out) <- levels(newdata$exact_age)[newdata$exact_age]

colnames(out) <- c("margin", "Std.Err", "lower 95% conf", "upper 95% conf")

print(out)
```

# Main Text Figures

## Figure 1 (Studies 1 & 2)

```{r}
# data wrangling for predicted probability plot (Studies 1 & 2)
df.lap_logit_model = ggpredict(model = lap_logit_model,
                               terms = "Age_Ex [all]") %>% 
  rename_all(function(x) paste0("lap_", x)) %>% 
  as.data.frame() %>% 
  mutate(id = 1:n()) %>% 
  as.data.frame() %>% 
  dplyr::select(-c(lap_group))

df.las_logit_model = ggpredict(model = las_logit_model,
                               terms = "Age_Ex [all]") %>% 
  as.data.frame() %>% 
  rename_all(function(x) paste0("las_", x)) %>% 
  mutate(id = 1:n()) %>% 
  as.data.frame() %>% 
  dplyr::select(-las_group)

df.combined_model = df.lap_logit_model %>% 
  left_join(df.las_logit_model, by = "id") %>% 
  pivot_longer(cols = -id,
               names_to = c("study", "value_type"),
               names_sep = "_",
               values_to = "value") %>% 
  pivot_wider(names_from = "value_type",
              values_from = "value") %>% 
  mutate(study = ifelse(study == "lap", 
                        "Lying about Performance", 
                        "Downplaying Success")) %>% 
  mutate(study = factor(study, 
                        levels = c("Lying about Performance", 
                                          "Downplaying Success")))
```

```{r}
# for individual data points (lying about poor performance)
df.lap_data = lap_data %>% 
  rename_all(function(x) paste0("lap_", x)) %>% 
  rename(Sub_ID = lap_Sub_ID,
         lap_AgeEx = lap_Age_Ex) %>% 
  select(c(Sub_ID, lap_AgeEx, lap_WhoLied)) %>% 
  mutate(lap_WhoLied = ifelse(lap_WhoLied == "Intrinsic", 0, 1))

# for individual data points (lying about good performance)
df.las_data = las_data %>% 
  rename_all(function(x) paste0("las_", x)) %>% 
  rename(Sub_ID = las_Sub_ID,
         las_AgeEx = las_Age_Ex) %>% 
  select(c(Sub_ID, las_AgeEx, las_WhoLied)) %>% 
  mutate(las_WhoLied = ifelse(las_WhoLied == "Intrinsic", 0, 1))

# combined df with individual data (studies 1 & 2)
df.combined_lap_las = df.lap_data %>% 
  left_join(df.las_data, by = "Sub_ID") %>% 
  pivot_longer(cols = -Sub_ID,
               names_to = c("study", "value_type"),
               names_sep = "_",
               values_to = "value") %>% 
  pivot_wider(names_from = "value_type",
              values_from = "value") %>% 
  mutate(study = ifelse(study == "lap", 
                        "Lying about Performance", 
                        "Downplaying Success")) %>% 
  mutate(study = factor(study, 
                        levels = c("Lying about Performance", 
                                   "Downplaying Success")))
```

```{r}
# text labels for plot
text_reputational = textGrob("Chose Student with\n Reputational Concerns", 
                              gp=gpar(fontsize=9, 
                                      fontface="bold"))
text_intrinsic = textGrob("Chose Student with\nIntrinsic Concerns", 
                           gp=gpar(fontsize=9, 
                                   fontface="bold"))
```

```{r}
# generate plot
df.combined_model %>% 
  ggplot(mapping = aes(x = x,
                       y = predicted,
                       group = study,
                       color = study,
                       fill = study)) +
  geom_ribbon(data = df.combined_model,
              mapping = aes(ymin = conf.low,
                            ymax = conf.high),
              linetype = 0,
              alpha = 0.3) + 
  geom_line(na.rm = TRUE) + 
  geom_point(data = df.combined_lap_las,
             mapping = aes(x = AgeEx,
                           y = WhoLied,
                           color = study)) + 
  scale_x_continuous(breaks = seq(4, 10, by = 1),
                     expand = c(.01, .01)) + 
  coord_cartesian(xlim = c(4, 10),
                  ylim = c(0, 1),
                  clip = "off") + 
  annotation_custom(text_reputational,
                    xmin=11.25,
                    xmax=11.25,
                    ymin=1,
                    ymax=1) + 
  annotation_custom(text_intrinsic,
                    xmin=11.25,
                    xmax=11.25,
                    ymin=0,
                    ymax=0) + 
  scale_y_continuous(breaks = seq(0, 1.00, by = .25),
                     expand = c(.01, .01)) + 
  scale_color_brewer(palette = "Set1") +
  scale_fill_brewer(palette = "Set1") +
  theme(text = element_text(size = 15,
                            family = "Times New Roman",
                            color = "black")) +
  labs(x = "Age (Continous)",
       y = "Predicted Probability of Choosing Student \n with Reputational Motives",
       fill = element_blank(),
       color = element_blank()) +
  theme_bw()
```
```{r}
ggsave("figure1_studies1and2.png", plot = last_plot(), width = 9.75)
```

## Figure 2 (Study 4)

```{r}
# data wrangling for predicted probability plot (Study 4)
df.pvp_logit_model = ggpredict(model = pvp_logit_model,
                               terms = c("Age_Ex [all]", "Condition")) 

# creating data frame for plot
df.pvp_logit_plot = df.pvp_logit_model %>% 
  as.data.frame() %>% 
  rename(condition = group) %>% 
  mutate(condition = ifelse(condition == "0", 
                            "Private Condition", 
                            "Public Condition")) %>% 
  mutate(condition = factor(condition, levels = c("Private Condition", 
                                                  "Public Condition")))

# formatting data for individual data points
df.pvp_data = pvp_data %>% 
  select(c(Sub_ID, Age_Ex, SoughtHelp, Condition)) %>% 
  rename(condition = Condition) %>% 
  mutate(condition = ifelse(condition == "private", 
                            "Private Condition", 
                            "Public Condition")) %>% 
  mutate(SoughtHelp = ifelse(SoughtHelp == "Intrinsic", 0, 1))
```

```{r}
# create predicted probability plot
df.pvp_logit_plot %>% 
  ggplot(mapping = aes(x = x,
                       y = predicted,
                       group = condition,
                       color = condition,
                       fill = condition)) +
  geom_ribbon(data = df.pvp_logit_plot,
              mapping = aes(ymin = conf.low,
                            ymax = conf.high),
              linetype = 0,
              alpha = 0.3) + 
  geom_line(na.rm = TRUE) + 
  scale_color_brewer(palette = "Set1") +
  scale_fill_brewer(palette = "Set1") +
  geom_point(data = df.pvp_data,
             mapping = aes(x = Age_Ex,
                           y = SoughtHelp,
                           color = condition)) + 
  scale_x_continuous(breaks = seq(4, 10, by = 1),
                     expand = c(.01, .01)) + 
  coord_cartesian(xlim = c(4, 10),
                  ylim = c(0, 1),
                  clip = "off") + 
  annotation_custom(text_reputational,
                    xmin=10.75,
                    xmax=10.75,
                    ymin=1,
                    ymax=1) + 
  annotation_custom(text_intrinsic,
                    xmin=10.75,
                    xmax=10.75,
                    ymin=0,
                    ymax=0) + 
  scale_y_continuous(breaks = seq(0, 1.00, by = .25),
                     expand = c(.01, .01)) + 
  theme(text = element_text(size = 15,
                            family = "Times New Roman",
                            color = "black")) +
  labs(x = "Age (Continous)",
       y = "Predicted Probability of Choosing Student \n with Reputational Motives",
       fill = element_blank(),
       color = element_blank()) +
  theme_bw()
```
```{r}
ggsave("figure2_study4.png", plot = last_plot(), width = 9.75)
```

## Figure 3 (Study 5)

```{r}
# Study 5 plot
# generate model predictions for each separate measure and combine into dataframe
df.liking_recoded = study5_data %>% 
  mutate(like_better = relevel(like_better,
                               ref = "Intrinsic"))

liking_model_aug_age_ex_rep = glm(like_better ~ exact_age, 
                                  data = df.liking_recoded, 
                                  family = binomial(link = "logit"))

df.liking_logit_model = ggpredict(model = liking_model_aug_age_ex_rep,
                               terms = "exact_age [all]") %>% 
  as.data.frame() %>% 
  rename_all(function(x) paste0("liking_", x)) %>% 
  mutate(id = 1:n()) %>% 
  select(-liking_group)

df.lap_logit_model = ggpredict(model = lap_model_aug_age_ex,
                               terms = "exact_age [all]") %>% 
  as.data.frame() %>% 
  rename_all(function(x) paste0("lap_", x)) %>% 
  mutate(id = 1:n()) %>% 
  select(-lap_group)

df.lah_logit_model = ggpredict(model = lah_model_aug_age_ex,
                               terms = "exact_age [all]") %>% 
  as.data.frame() %>% 
  rename_all(function(x) paste0("lah_", x)) %>% 
  mutate(id = 1:n()) %>% 
  select(-lah_group)

df.combined_model = df.liking_logit_model %>% 
  left_join(df.lap_logit_model, by = "id") %>% 
  left_join(df.lah_logit_model, by = "id") %>% 
  pivot_longer(cols = -id,
               names_to = c("study", "value_type"),
               names_sep = "_",
               values_to = "value") %>% 
  pivot_wider(names_from = "value_type",
              values_from = "value") %>% 
  mutate(study = ifelse(study == "liking", 
                        "Who do you like better?",
                        ifelse(study == "lap",
                               "Who lied about perfoming poorly?",
                               "Who lied about having helped?"))) %>% 
  mutate(study = factor(study, levels = c("Who do you like better?", 
                                          "Who lied about perfoming poorly?", 
                                          "Who lied about having helped?")))
```

```{r}
# get individual data
df.liking_data = study5_data %>% 
  select(c(new_ID,
         like_better,
         exact_age)) %>% 
  rename(measure = like_better) %>% 
  rename_all(function(x) paste0("liking_", x)) %>% 
  rename(id = liking_new_ID) %>% 
  mutate(liking_measure = ifelse(liking_measure == "Intrinsic", 0, 1))

df.lap_data = study5_data %>% 
  select(c(new_ID,
         lap,
         exact_age)) %>% 
  rename(measure = lap) %>% 
  rename_all(function(x) paste0("lap_", x)) %>% 
  rename(id = lap_new_ID) %>% 
  mutate(lap_measure = ifelse(lap_measure == "Intrinsic", 0, 1))

df.lah_data = study5_data %>% 
  select(c(new_ID,
         lah,
         exact_age)) %>% 
  rename(measure = lah) %>% 
  rename_all(function(x) paste0("lah_", x)) %>% 
  rename(id = lah_new_ID) %>% 
  mutate(lah_measure = ifelse(lah_measure == "Intrinsic", 0, 1))

df.combined_individual_data = df.liking_data %>% 
  left_join(df.lap_data, by = "id") %>% 
  left_join(df.lah_data, by = "id") %>% 
  pivot_longer(cols = -id,
               names_to = c("study", "value_type"),
               names_sep = "_",
               values_to = "value") %>% 
  pivot_wider(names_from = "value_type",
              values_from = "value") %>% 
  mutate(study = ifelse(study == "liking", 
                        "Who do you like better?",
                        ifelse(study == "lap",
                               "Who lied about perfoming poorly?",
                               "Who lied about having helped?"))) %>% 
  mutate(study = factor(study, levels = c("Who do you like better?", 
                                          "Who lied about perfoming poorly?", 
                                          "Who lied about having helped?")))
```

```{r}
text_reputational = textGrob("Chose Student with\n Reputational Concerns", 
                              gp=gpar(fontsize=9, 
                                      fontface="bold"))
text_intrinsic = textGrob("Chose Student with\nIntrinsic Concerns", 
                           gp=gpar(fontsize=9, 
                                   fontface="bold"))
```

```{r}
set.seed(0)
df.combined_model %>% 
  ggplot(mapping = aes(x = x,
                       y = predicted,
                       group = study,
                       color = study,
                       fill = study)) +
  geom_ribbon(data = df.combined_model,
              mapping = aes(ymin = conf.low,
                            ymax = conf.high),
              linetype = 0,
              alpha = 0.3) + 
  geom_line(na.rm = TRUE) + 
  geom_point(data = df.combined_individual_data,
             mapping = aes(x = exact,
                           y = measure,
                           color = study),
             position = position_jitter(w = 0,
                                        h = 0.025),
             alpha = 0.5) + 
  scale_x_continuous(breaks = seq(4, 10, by = 1),
                     expand = c(.01, .01)) + 
  coord_cartesian(xlim = c(4, 10),
                  ylim = c(-0.03, 1.03),
                  clip = "off") + 
    annotation_custom(text_reputational,
                    xmin=10.82,
                    xmax=10.82,
                    ymin=1,
                    ymax=1) + 
  annotation_custom(text_intrinsic,
                    xmin=10.74,
                    xmax=10.74,
                    ymin=0,
                    ymax=0) + 
  scale_y_continuous(breaks = seq(0, 1.00, by = .25),
                     expand = c(.01, .01)) + 
  # scale_color_brewer(palette = "Set1") +
  # scale_fill_brewer(palette = "Set1") +
  labs(x = "Age (Continous)",
       y = "Predicted Probability of Choosing Student \n with Reputational Motives",
       fill = element_blank(),
       color = element_blank()) +
  theme_bw()
```
```{r}
ggsave("figure3_study5.png", plot = last_plot(), width = 9.75)
```

# Supplementary Analyses & Figures

## Checking for Effects of Gender, Order, etc. Across Studies

### Study 1

```{r}
# generates logistic regression model examining the effect of gender on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would lie about their poor performance
lap_logit_gender_model = glm(WhoLied ~ Sex, 
                       data = lap_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(lap_logit_gender_model)
```

```{r}
# generates Wald chi square statistic for main effect of gender
lap_gender_wald_test = wald.test(b = coef(lap_logit_gender_model),
                           Sigma = vcov(lap_logit_gender_model), 
                           Terms = 2, 
                           verbose = TRUE) 

print(lap_gender_wald_test, digits = 5) # prints results of Wald chi-square test
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_gender_model), confint.default(lap_logit_gender_model, level = 0.95)))
```

```{r}
# generates logistic regression model examining interaction between age and gender
lap_logit_gender_int_model = glm(WhoLied ~ Sex*Age_Ex, 
                       data = lap_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(lap_logit_gender_int_model)
```

```{r}
# generates Wald chi square statistic for interaction between age and gender
lap_gender_int_wald_test = wald.test(b = coef(lap_logit_gender_int_model),
                           Sigma = vcov(lap_logit_gender_int_model), 
                           Terms = 4, 
                           verbose = TRUE)

print(lap_gender_int_wald_test, digits = 5)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_gender_int_model), confint.default(lap_logit_gender_int_model, level = 0.95)))
```

```{r}
# generates logistic regression model examining the effect of order in which
# characters were presented on whether children identified the character with 
# reputational or intrinsic concerns as the one who would lie about their poor performance
lap_logit_order_model = glm(WhoLied ~ Script, 
                       data = lap_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(lap_logit_order_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_order_model), confint.default(lap_logit_order_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of character order
lap_order_wald_test = wald.test(b = coef(lap_logit_order_model),
                           Sigma = vcov(lap_logit_order_model), 
                           Terms = 2, 
                           verbose = TRUE) 

print(lap_order_wald_test, digits = 5) # prints results of Wald chi-square test
```

```{r}
# generates logistic regression model examining interaction between age and character order
lap_logit_order_int_model = glm(WhoLied ~ Script*Age_Ex, 
                       data = lap_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(lap_logit_order_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_order_int_model), confint.default(lap_logit_order_int_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and character order
lap_order_int_wald_test = wald.test(b = coef(lap_logit_order_int_model),
                           Sigma = vcov(lap_logit_order_int_model), 
                           Terms = 4, 
                           verbose = TRUE)

print(lap_order_int_wald_test, digits = 5) # prints results of Wald chi-square test
```

### Study 2

```{r}
# generates logistic regression model examining the effect of gender
# on whether children identified the character with reputational or intrinsic 
# concerns as the one who would lie about their poor performance
las_gender_logit_model = glm(WhoLied ~ Sex, 
                       data = las_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(las_gender_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(las_gender_logit_model), confint.default(las_gender_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of gender
las_gender_wald_test = wald.test(b = coef(las_gender_logit_model),
                           Sigma = vcov(las_gender_logit_model), 
                           Terms = 2, 
                           verbose = TRUE) 

print(las_gender_wald_test, digits = 4) # prints results of Wald chi-square test
```

```{r}
# generates logistic regression model for interaction between age and gender
las_gender_int_logit_model = glm(WhoLied ~ Sex*Age_Ex, 
                       data = las_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(las_gender_int_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(las_gender_int_logit_model), confint.default(las_gender_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and gender
las_gender_int_wald_test = wald.test(b = coef(las_gender_int_logit_model),
                           Sigma = vcov(las_gender_int_logit_model), 
                           Terms = 4, 
                           verbose = TRUE) 

print(las_gender_int_wald_test, digits = 4) # prints results of Wald chi-square test
```

```{r}
# generates logistic regression model examining the effect of character order
# on whether children identified the character with reputational or intrinsic 
# concerns as the one who would lie about their poor performance
las_order_logit_model = glm(WhoLied ~ Script, 
                       data = las_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(las_order_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(las_order_logit_model), confint.default(las_order_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of character order
las_order_wald_test = wald.test(b = coef(las_order_logit_model),
                           Sigma = vcov(las_order_logit_model), 
                           Terms = 2, 
                           verbose = TRUE) 

print(las_order_wald_test, digits = 4) # prints results of Wald chi-square test
```

```{r}
# generates logistic regression model for interaction between age and character order
las_order_int_logit_model = glm(WhoLied ~ Script*Age_Ex, 
                       data = las_data, 
                       family = binomial(link = "logit"))
```

```{r}
summary(las_order_int_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(las_order_int_logit_model), confint.default(las_order_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and character order
las_order_int_wald_test = wald.test(b = coef(las_order_int_logit_model),
                           Sigma = vcov(las_order_int_logit_model), 
                           Terms = 4, 
                           verbose = TRUE)

print(las_order_int_wald_test, digits = 4) # prints results of Wald chi-square test
```

### Study 3


```{r}
# generates logistic regression model examining the effect of gender on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would publicly seek help
psh_logit_gender_model = glm(WhoAsked ~ Sex, 
                              data = psh_data, 
                              family = binomial(link = "logit"))
```

```{r}
summary(psh_logit_gender_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(psh_logit_gender_model), confint.default(psh_logit_gender_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of gender
psh_gender_wald_test = wald.test(b = coef(psh_logit_gender_model), 
                                  Sigma = vcov(psh_logit_gender_model), 
                                  Terms = 2, 
                                  verbose = TRUE)

print(psh_gender_wald_test, digits = 4)
```

```{r}
# generates logistic regression model examining interaction between age and gender
psh_logit_gender_int_model = glm(WhoAsked ~ Sex*Age_Ex, 
                              data = psh_data, 
                              family = binomial(link = "logit"))
```

```{r}
summary(psh_logit_gender_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(psh_logit_gender_int_model), confint.default(psh_logit_gender_int_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and gender
psh_gender_int_wald_test = wald.test(b = coef(psh_logit_gender_int_model), 
                                  Sigma = vcov(psh_logit_gender_int_model), 
                                  Terms = 4, 
                                  verbose = TRUE)

print(psh_gender_int_wald_test, digits = 4)
```

```{r}
# generates logistic regression model examining the effect of character order on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would publicly seek help
psh_logit_order_model = glm(WhoAsked ~ Script, 
                              data = psh_data, 
                              family = binomial(link = "logit"))
```

```{r}
summary(psh_logit_order_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(psh_logit_order_model), confint.default(psh_logit_order_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of character order
psh_order_wald_test = wald.test(b = coef(psh_logit_order_model), 
                                  Sigma = vcov(psh_logit_order_model), 
                                  Terms = 2, 
                                  verbose = TRUE)

print(psh_order_wald_test, digits = 4)
```

```{r}
# generates logistic regression model examining interaction between age and character order
psh_logit_order_int_model = glm(WhoAsked ~ Script*Age_Ex, 
                              data = psh_data, 
                              family = binomial(link = "logit"))
```

```{r}
summary(psh_logit_order_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(psh_logit_order_int_model), confint.default(psh_logit_order_int_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and character order
psh_order_int_wald_test = wald.test(b = coef(psh_logit_order_int_model), 
                                  Sigma = vcov(psh_logit_order_int_model), 
                                  Terms = 4, 
                                  verbose = TRUE)

print(psh_order_int_wald_test, digits = 4)
```

### Study 4

#### Both Conditions

```{r}
# generates logistic regression model examining interaction between gender and 
# condition on whether children identified the character with reputational or 
# intrinsic concerns as the one who would seek help
pvp_gender_condition_int_logit_model = glm(formula = SoughtHelp ~ factor(Condition) * Sex, 
                              data = recoded_pvp_data, 
                              family = "binomial")
```

```{r}
summary(pvp_gender_condition_int_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_gender_condition_int_logit_model), confint.default(pvp_gender_condition_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between gender and condition
pvp_wald_test_condition_gender_effect <- wald.test(b = coef(pvp_gender_condition_int_logit_model),
                                                     Sigma = vcov(pvp_gender_condition_int_logit_model), 
                                                     Terms = 4, 
                                                     verbose = TRUE)

print(pvp_wald_test_condition_gender_effect, digits = 4)
```

```{r}
# generates logistic regression model examining interaction between gender, age,
# and condition
pvp_gender_condition_age_int_model <- glm(formula = SoughtHelp ~ Age_Ex * factor(Condition) * Sex, 
                              data = recoded_pvp_data, 
                              family = "binomial")
```

```{r}
summary(pvp_gender_condition_age_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_gender_condition_age_int_model), confint.default(pvp_gender_condition_age_int_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between gender, age,
# and condition
pvp_wald_test_gender_condition_age_int = wald.test(b = coef(pvp_gender_condition_age_int_model),
                                                     Sigma = vcov(pvp_gender_condition_age_int_model), 
                                                     Terms = 8, 
                                                     verbose = TRUE)
print(pvp_wald_test_gender_condition_age_int, digits = 4)
```

```{r}
# generates logistic regression model examining interaction between character order and 
# condition on whether children identified the character with reputational or 
# intrinsic concerns as the one who would seek help
pvp_order_condition_int_logit_model = glm(formula = SoughtHelp ~ factor(Condition) * Script, 
                              data = recoded_pvp_data, 
                              family = "binomial")
```

```{r}
summary(pvp_order_condition_int_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_order_condition_int_logit_model), confint.default(pvp_order_condition_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between character order and condition
pvp_wald_test_condition_order_effect = wald.test(b = coef(pvp_order_condition_int_logit_model),
                                                     Sigma = vcov(pvp_order_condition_int_logit_model), 
                                                     Terms = 4, 
                                                     verbose = TRUE)

print(pvp_wald_test_condition_order_effect, digits = 4)
```

```{r}
# generates logistic regression model examining interaction between character order, age,
# and condition
pvp_order_condition_age_logit_model = glm(formula = SoughtHelp ~ Age_Ex * factor(Condition) * Script, 
                              data = recoded_pvp_data, 
                              family = "binomial") 
```

```{r}
summary(pvp_order_condition_age_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_order_condition_age_logit_model), confint.default(pvp_order_condition_age_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between character order, age,
# and condition
pvp_wald_test_interaction_effect_order <- wald.test(b = coef(pvp_order_condition_age_logit_model),
                                                     Sigma = vcov(pvp_order_condition_age_logit_model), 
                                                     Terms = 8, 
                                                     verbose = TRUE)

print(pvp_wald_test_interaction_effect_order, digits = 4)
```

#### Private Help-Seeking Condition

```{r}
# generates logistic regression model examining effect of gender on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would seek help privately
pvp_private_gender_logit_model = glm(SoughtHelp ~ Sex, 
                                  data = study4_private_data, 
                                  family = binomial(link = "logit"))
```

```{r}
summary(pvp_private_gender_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_private_gender_logit_model), confint.default(pvp_private_gender_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of gender
pvp_private_gender_wald_test = wald.test(b = coef(pvp_private_gender_logit_model),
                                      Sigma = vcov(pvp_private_gender_logit_model), 
                                      Terms = 2, 
                                      verbose = TRUE) 

print(pvp_private_gender_wald_test, digits = 4)
```

```{r}
# breakdown of private help-seeking by gender
private_summary_liking_gender = study4_private_data %>%
  group_by(Sex) %>%
  summarise(percent_intrinsic = (sum(SoughtHelp == "Intrinsic")/length(Sub_ID))*100,
            number_intrinsic = (sum(SoughtHelp == "Intrinsic")),
            percent_reputational = (sum(SoughtHelp == "Reputational")/length(Sub_ID))*100,
            number_reputational = (sum(SoughtHelp == "Reputational")),
            total_n = (sum(SoughtHelp == "Intrinsic"|SoughtHelp == "Reputational"))) 

private_summary_liking_gender %>% 
  kable(caption = "Who sought help privately? (By Gender)") # generates table
```

```{r}
# generates logistic regression model examining interaction between age and gender
pvp_private_gender_int_logit_model = glm(SoughtHelp ~ Sex*Age_Ex, 
                                  data = study4_private_data, 
                                  family = binomial(link = "logit"))
```

```{r}
summary(pvp_private_gender_int_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_private_gender_int_logit_model), confint.default(pvp_private_gender_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and gender
pvp_private_gender_int_wald_test = wald.test(b = coef(pvp_private_gender_int_logit_model),
                                      Sigma = vcov(pvp_private_gender_int_logit_model), 
                                      Terms = 4, 
                                      verbose = TRUE) 

print(pvp_private_gender_int_wald_test, digits = 4)
```

```{r}
# generates logistic regression model examining effect of character order on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would seek help privately
pvp_private_order_logit_model = glm(SoughtHelp ~ Script,
                                  data = study4_private_data,
                                  family = binomial(link = "logit"))
```

```{r}
summary(pvp_private_order_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_private_order_logit_model), confint.default(pvp_private_order_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of character order
pvp_private_order_wald_test = wald.test(b = coef(pvp_private_order_logit_model),
                                      Sigma = vcov(pvp_private_order_logit_model), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(pvp_private_order_wald_test, digits = 4)
```

```{r}
# generates logistic regression model examining interaction between age and character order
pvp_private_order_int_logit_model = glm(SoughtHelp ~ Script*Age_Ex,
                                  data = study4_private_data,
                                  family = binomial(link = "logit"))
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_private_order_int_logit_model), confint.default(pvp_private_order_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and character order
pvp_private_order_int_wald_test = wald.test(b = coef(pvp_private_order_int_logit_model),
                                      Sigma = vcov(pvp_private_order_int_logit_model), 
                                      Terms = 4, 
                                      verbose = TRUE) 

print(pvp_private_order_int_wald_test, digits = 4)
```

### Public Help-Seeking Condition

```{r}
# generates logistic regression model examining effect of gender on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would seek help publicly
pvp_public_gender_logit_model = glm(SoughtHelp ~ Sex, 
                                 data = study4_public_data, 
                                 family = binomial(link = "logit"))
```

```{r}
summary(pvp_public_gender_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_public_gender_logit_model), confint.default(pvp_public_gender_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of gender
pvp_public_gender_wald_test = wald.test(b=coef(pvp_public_gender_logit_model),
                                     Sigma = vcov(pvp_public_gender_logit_model), 
                                     Terms = 2, 
                                     verbose = TRUE)

print(pvp_public_gender_wald_test, digits = 4)
```

```{r}
# breakdown of public help-seeking by gender
public_summary_liking_gender = study4_public_data %>%
  group_by(Sex) %>%
  summarise(percent_intrinsic = (sum(SoughtHelp == "Intrinsic")/length(Sub_ID))*100,
            number_intrinsic = (sum(SoughtHelp == "Intrinsic")),
            percent_reputational = (sum(SoughtHelp == "Reputational")/length(Sub_ID))*100,
            number_reputational = (sum(SoughtHelp == "Reputational")),
            total_n = (sum(SoughtHelp == "Intrinsic"|SoughtHelp == "Reputational"))) 

public_summary_liking_gender %>% 
  kable(caption = "Who sought help publicly? (By Gender)") # generates table
```

```{r}
# generates logistic regression model examining interaction between age and gender
pvp_public_gender_int_logit_model = glm(SoughtHelp ~ Sex*Age_Ex, 
                                 data = study4_public_data, 
                                 family = binomial(link = "logit")) 
```

```{r}
summary(pvp_public_gender_int_logit_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_public_gender_int_logit_model), confint.default(pvp_public_gender_int_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and gender
pvp_public_gender_int_wald_test = wald.test(b=coef(pvp_public_gender_int_logit_model),
                                     Sigma = vcov(pvp_public_gender_int_logit_model), 
                                     Terms = 4, 
                                     verbose = TRUE)

print(pvp_public_gender_int_wald_test, digits = 4) 
```

```{r}
# generates logistic regression model examining effect of character order on whether 
# children identified the character with reputational or intrinsic concerns 
# as the one who would seek help publicly
pvp_public_order_logit_model = glm(SoughtHelp ~ Script,
                                  data = study4_public_data,
                                  family = binomial(link = "logit"))
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_public_order_logit_model), confint.default(pvp_public_order_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for main effect of character order
pvp_public_order_wald_test = wald.test(b=coef(pvp_public_order_logit_model),
                                     Sigma = vcov(pvp_public_order_logit_model), 
                                     Terms = 2, 
                                     verbose = TRUE)

print(pvp_public_order_wald_test, digits = 4) 
```

```{r}
# generates logistic regression model examining interaction between age and character order
pvp_public_order_int_logit_model = glm(SoughtHelp ~ Script*Age_Ex,
                                  data = study4_public_data,
                                  family = binomial(link = "logit"))
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(pvp_public_order_logit_model), confint.default(pvp_public_order_logit_model, level = 0.95)))
```

```{r}
# generates Wald chi square statistic for interaction between age and character order
pvp_public_order_int_wald_test = wald.test(b=coef(pvp_public_order_int_logit_model),
                                     Sigma = vcov(pvp_public_order_int_logit_model), 
                                     Terms = 4, 
                                     verbose = TRUE)

print(pvp_public_order_int_wald_test, digits = 4) 
```

### Study 5

```{r}
# create df with binary study order column
df.study_order_binary = study5_data %>% 
  mutate(study_order_first = ifelse(study_order == 1,
                                    1,
                                    2))
```

#### All Measures

```{r}
gee_model_1 = geeglm(formula = Response ~ 1,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

gee_model_2 = geeglm(formula = Response ~ child_gender,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

anova(gee_model_1,
      gee_model_2)
```

```{r}
exp(cbind("Odds ratio" = coef(gee_model_2), confint.default(gee_model_2, level = 0.95)))
```

```{r}
gee_model_3 = geeglm(formula = Response ~ child_gender + exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

gee_model_4 = geeglm(formula = Response ~ child_gender*exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

anova(gee_model_3,
      gee_model_4)
```

```{r}
exp(cbind("Odds ratio" = coef(gee_model_4), confint.default(gee_model_4, level = 0.95)))
```

```{r}
gee_model_5 = geeglm(formula = Response ~ 1,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

gee_model_6 = geeglm(formula = Response ~ Condition,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

anova(gee_model_5,
      gee_model_6)
```

```{r}
exp(cbind("Odds ratio" = coef(gee_model_6), confint.default(gee_model_6, level = 0.95)))
```

```{r}
gee_model_7 = geeglm(formula = Response ~ Condition + exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

gee_model_8 = geeglm(formula = Response ~ Condition*exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.long_study_5,
                   corstr = "unstructured",
                   std.err = "san.se")

anova(gee_model_7,
      gee_model_8)
```

```{r}
exp(cbind("Odds ratio" = coef(gee_model_8), confint.default(gee_model_8, level = 0.95)))
```

```{r}
df.study_order_binary_long = df.long_study_5 %>% 
  mutate(study_order_first = ifelse(study_order == 1,
                                    1,
                                    2))
```

```{r}
gee_model_9 = geeglm(formula = Response ~ 1,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.study_order_binary_long,
                   corstr = "unstructured",
                   std.err = "san.se")

gee_model_10 = geeglm(formula = Response ~ study_order_first,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.study_order_binary_long,
                   corstr = "unstructured",
                   std.err = "san.se")

anova(gee_model_9,
      gee_model_10)
```

```{r}
exp(cbind("Odds ratio" = coef(gee_model_10), confint.default(gee_model_10, level = 0.95)))
```

```{r}
gee_model_11 = geeglm(formula = Response ~ study_order_first + exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.study_order_binary_long,
                   corstr = "unstructured",
                   std.err = "san.se")

gee_model_12 = geeglm(formula = Response ~ study_order_first*exact_age,
                   family = binomial(link = "logit"),
                   id = new_ID,
                   data = df.study_order_binary_long,
                   corstr = "unstructured",
                   std.err = "san.se")

anova(gee_model_11,
      gee_model_12)
```

```{r}
exp(cbind("Odds ratio" = coef(gee_model_12), confint.default(gee_model_12, level = 0.95)))
```

#### Liking Measure

```{r}
# check for main effect of gender (liking measure)
liking_logit_gender_model = glm(like_better ~ child_gender, 
                       data = df.liking_recoded, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(liking_logit_gender_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_logit_gender_model), confint.default(liking_logit_gender_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for main effect of gender
liking_gender_wald_test = wald.test(b = coef(liking_logit_gender_model),
                                      Sigma = vcov(liking_logit_gender_model), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(liking_gender_wald_test, digits = 4)
```

```{r}
# response breakdown (Q1 - liking measure by gender)
study5_summary_liking_gender = study5_data %>%
  group_by(child_gender) %>%
  summarise(percent_intrinsic = (sum(like_better == "Intrinsic")/length(new_ID))*100,
            number_intrinsic = (sum(like_better == "Intrinsic")),
            percent_reputational = (sum(like_better == "Reputational")/length(new_ID))*100,
            number_reputational = (sum(like_better == "Reputational")),
            total_n = (sum(like_better == "Intrinsic"|like_better == "Reputational"))) 

study5_summary_liking_gender %>% 
  kable(caption = "Who do you like better? (By Gender)") # generates table
```

```{r}
# check for interaction between age and gender (liking measure)
liking_logit_gender_age_int_model = glm(like_better ~ child_gender*exact_age, 
                       data = df.liking_recoded, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(liking_logit_gender_age_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_logit_gender_age_int_model), confint.default(liking_logit_gender_age_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for interaction between age and gender
liking_gender_int_wald_test = wald.test(b = coef(liking_logit_gender_age_int_model),
                                      Sigma = vcov(liking_logit_gender_age_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(liking_gender_int_wald_test, digits = 4)
```

```{r}
# check for main effect of character order (Q1 - liking measure)
liking_logit_char_order_model = glm(like_better ~ Condition, 
                       data = df.liking_recoded, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(liking_logit_char_order_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_logit_char_order_model), confint.default(liking_logit_char_order_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic
liking_char_order_wald_test = wald.test(b = coef(liking_logit_char_order_model),
                                      Sigma = vcov(liking_logit_char_order_model), 
                                      Terms = 2, 
                                      verbose = TRUE) 

print(liking_char_order_wald_test, digits = 4) 
```

```{r}
# response breakdown (Q1 - liking measure by character order)
study5_summary_liking_char_order = study5_data %>%
  group_by(Condition) %>%
  summarise(percent_intrinsic = (sum(like_better == "Intrinsic")/length(new_ID))*100,
            number_intrinsic = (sum(like_better == "Intrinsic")),
            percent_reputational = (sum(like_better == "Reputational")/length(new_ID))*100,
            number_reputational = (sum(like_better == "Reputational")),
            total_n = (sum(like_better == "Intrinsic"|like_better == "Reputational"))) 

study5_summary_liking_char_order %>% 
  kable(caption = "Who do you like better? (By Character Order)") # generates table
```

```{r}
# check for interaction between age and character order (Q1 - liking measure)
liking_logit_char_order_int_model = glm(like_better ~ Condition*exact_age, 
                       data = df.liking_recoded, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(liking_logit_char_order_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_logit_char_order_int_model), confint.default(liking_logit_char_order_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic
liking_char_order_int_wald_test = wald.test(b = coef(liking_logit_char_order_int_model),
                                      Sigma = vcov(liking_logit_char_order_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(liking_char_order_int_wald_test, digits = 4)
```

```{r}
df.liking_recoded_study_order = df.liking_recoded %>% 
    mutate(study_order_first = ifelse(study_order == 1,
                                    1,
                                    2))
```

```{r}
# check for main effect of study order (Q1 - liking measure)
liking_logit_order_binary_model = glm(like_better ~ study_order_first, 
                       data = df.liking_recoded_study_order, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(liking_logit_order_binary_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_logit_order_binary_model), confint.default(liking_logit_order_binary_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic
liking_order_wald_test = wald.test(b = coef(liking_logit_order_binary_model),
                                      Sigma = vcov(liking_logit_order_binary_model), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(liking_order_wald_test, digits = 4) 
```

```{r}
# breakdown of liking by study order
study5_summary_liking_study_order = study5_data %>%
  mutate(order_first_or_not = ifelse(study_order == "1",
                                     "Yes",
                                     "No")) %>% 
  group_by(order_first_or_not) %>%
  summarise(percent_intrinsic = (sum(like_better == "Intrinsic")/length(new_ID))*100,
            number_intrinsic = (sum(like_better == "Intrinsic")),
            percent_reputational = (sum(like_better == "Reputational")/length(new_ID))*100,
            number_reputational = (sum(like_better == "Reputational")),
            total_n = (sum(like_better == "Intrinsic"|like_better == "Reputational"))) 

study5_summary_liking_study_order %>% 
  kable(caption = "Who do you like better? (By Study Order)") # generates table
```

```{r}
# check for interaction (age and study order) (Q1 - liking measure)
liking_logit_order_binary_int_model = glm(like_better ~ study_order_first * exact_age, 
                       data = df.liking_recoded_study_order, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(liking_logit_order_binary_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(liking_logit_order_binary_int_model), confint.default(liking_logit_order_binary_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic
liking_order_int_wald_test = wald.test(b = coef(liking_logit_order_binary_int_model),
                                      Sigma = vcov(liking_logit_order_binary_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(liking_order_int_wald_test, digits = 4)
```

#### Lying about Performance Measure

```{r}
# check for main effect of gender (lying about performance measure)
lap_logit_gender_model = glm(lap ~ child_gender, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lap_logit_gender_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_gender_model), confint.default(lap_logit_gender_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for main effect of gender
lap_gender_wald_test = wald.test(b = coef(lap_logit_gender_model),
                                      Sigma = vcov(lap_logit_gender_model), 
                                      Terms = 2, 
                                      verbose = TRUE) 

print(lap_gender_wald_test, digits = 4)
```

```{r}
# check for interaction between age and gender (lying about performance measure)
lap_logit_gender_int_model = glm(lap ~ child_gender*exact_age, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lap_logit_gender_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_gender_int_model), confint.default(lap_logit_gender_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for interaction between age and gender
lap_gender_int_wald_test = wald.test(b = coef(lap_logit_gender_int_model),
                                      Sigma = vcov(lap_logit_gender_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(lap_gender_int_wald_test, digits = 4) 
```

```{r}
# check for main effect of character order (Q2 - lap measure)
lap_logit_char_order_model = glm(lap ~ Condition, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lap_logit_char_order_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_char_order_model), confint.default(lap_logit_char_order_model, level = 0.95)))
```


```{r}
# generate Wald chi square statistic for main effect of character order
lap_char_order_wald_test = wald.test(b = coef(lap_logit_char_order_model),
                                      Sigma = vcov(lap_logit_char_order_model), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(lap_char_order_wald_test, digits = 4)
```

```{r}
# check for interaction between age and character order (Q2 - lap measure)
lap_logit_char_order_int_model = glm(lap ~ Condition*exact_age, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lap_logit_char_order_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_char_order_int_model), confint.default(lap_logit_char_order_int_model, level = 0.95)))
```

```{r}
# check for interaction between age and character order (Q2 - lap measure)
lap_char_order_int_wald_test = wald.test(b = coef(lap_logit_char_order_int_model),
                                      Sigma = vcov(lap_logit_char_order_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(lap_char_order_int_wald_test, digits = 4)
```

```{r}
# check for main effect of study order (Q2 - lying about performance measure)
lap_logit_order_binary_model = glm(lap ~ study_order_first, 
                       data = df.study_order_binary, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lap_logit_order_binary_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_order_binary_model), confint.default(lap_logit_order_binary_model, level = 0.95)))
```

```{r}
# calculate Wald chi square statistic
lap_order_wald_test = wald.test(b = coef(lap_logit_order_binary_model),
                                      Sigma = vcov(lap_logit_order_binary_model), 
                                      Terms = 2, 
                                      verbose = TRUE) 

print(lap_order_wald_test, digits = 4)
```

```{r}
# check for interaction (age and study order) (Q2 - lying about performance measure)
lap_logit_order_binary_int_model = glm(lap ~ study_order_first * exact_age, 
                       data = df.study_order_binary, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lap_logit_order_binary_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lap_logit_order_binary_int_model), confint.default(lap_logit_order_binary_int_model, level = 0.95)))
```

```{r}
# calculate Wald chi square statistic
lap_order_int_wald_test = wald.test(b = coef(lap_logit_order_binary_int_model),
                                      Sigma = vcov(lap_logit_order_binary_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(lap_order_int_wald_test, digits = 4)
```

#### Lying about Helping Measure

```{r}
# check for main effect of gender (lying about helping measure)
lah_logit_gender_model = glm(lah ~ child_gender, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lah_logit_gender_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_logit_gender_model), confint.default(lah_logit_gender_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for main effect of gender
lah_gender_wald_test = wald.test(b = coef(lah_logit_gender_model),
                                      Sigma = vcov(lah_logit_gender_model), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(lah_gender_wald_test, digits = 4)
```

```{r}
# check for interaction between age and gender (lying about helping measure)
lah_logit_gender_int_model = glm(lah ~ child_gender*exact_age, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lah_logit_gender_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_logit_gender_int_model), confint.default(lah_logit_gender_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for interaction between age and gender
lah_gender_int_wald_test = wald.test(b = coef(lah_logit_gender_int_model),
                                      Sigma = vcov(lah_logit_gender_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(lah_gender_int_wald_test, digits = 4)
```

```{r}
# check for main effect of character order (Q3 - lah measure)
lah_logit_char_order_model = glm(lah ~ Condition, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lah_logit_char_order_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_logit_char_order_model), confint.default(lah_logit_char_order_model, level = 0.95)))
```


```{r}
# generate Wald chi square statistic for main effect of character order
lah_char_order_wald_test = wald.test(b = coef(lah_logit_char_order_model),
                                      Sigma = vcov(lah_logit_char_order_model), 
                                      Terms = 2, 
                                      verbose = TRUE) 

print(lah_char_order_wald_test, digits = 4) 
```

```{r}
# check for interaction between age and character order (Q3 - lah measure)
lah_logit_char_order_int_model = glm(lah ~ Condition*exact_age, 
                       data = study5_data, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lah_logit_char_order_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_logit_char_order_int_model), confint.default(lah_logit_char_order_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic for interaction between age and character order
lah_char_order_int_wald_test = wald.test(b = coef(lah_logit_char_order_int_model),
                                      Sigma = vcov(lah_logit_char_order_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(lah_char_order_int_wald_test, digits = 4)
```

```{r}
# check for main effect of study order (Q3 - lying about helping measure)
lah_logit_order_binary_model = glm(lah ~ study_order_first, 
                       data = df.study_order_binary, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lah_logit_order_binary_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_logit_order_binary_model), confint.default(lah_logit_order_binary_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic
lah_order_wald_test = wald.test(b = coef(lah_logit_order_binary_model),
                                      Sigma = vcov(lah_logit_order_binary_model), 
                                      Terms = 2, 
                                      verbose = TRUE)

print(lah_order_wald_test, digits = 4) 
```

```{r}
# check for interaction (age and study order) (Q3 - lying about helping measure)
lah_logit_order_binary_int_model = glm(lah ~ study_order_first * exact_age, 
                       data = df.study_order_binary, 
                       family = binomial(link = "logit")) 
```

```{r}
summary(lah_logit_order_binary_int_model)
```

```{r}
# get odds ratio + 95% CIs
exp(cbind("Odds ratio" = coef(lah_logit_order_binary_int_model), confint.default(lah_logit_order_binary_int_model, level = 0.95)))
```

```{r}
# generate Wald chi square statistic
lah_order_int_wald_test = wald.test(b = coef(lah_logit_order_binary_int_model),
                                      Sigma = vcov(lah_logit_order_binary_int_model), 
                                      Terms = 4, 
                                      verbose = TRUE)

print(lah_order_int_wald_test, digits = 4)
```


## Study 5 - Composite Score Analysis

### Primary Analyses

```{r}
# age in years (continuous) as predictor
composite_model_aug_age_ex = polr(composite_score ~ exact_age,
                           data = study5_data)

composite_model_age_ex_compact = polr(composite_score ~ 1,
                           data = study5_data)
```

```{r}
composite_model_aug_age_ex_coef = coef(summary(composite_model_aug_age_ex))
```

```{r}
# generate p values
composite_model_aug_age_ex_p_values = pnorm(abs(composite_model_aug_age_ex_coef[, "t value"]), lower.tail = FALSE) * 2

## combined table
composite_model_aug_age_ex_coef = cbind(composite_model_aug_age_ex_coef, "p_value" = composite_model_aug_age_ex_p_values)

composite_model_aug_age_ex_coef %>% 
  kable(caption = "Age (Entered Continuously) Predicts Composite Scores")
```

```{r}
# calculate wald chi-square value
composite_wald_test_age_ex = waldtest(composite_model_age_ex_compact,
                                    composite_model_aug_age_ex)

print(composite_wald_test_age_ex)
```

### Checking for Effects of Gender, Order, etc. on Composite Measure

#### Gender 

```{r}
# check for main effect of gender (composite measure)
composite_gender_model_aug = polr(composite_score ~ child_gender,
                           data = study5_data,
                           Hess = TRUE)

composite_gender_model_compact = polr(composite_score ~ 1,
                           data = study5_data)
```

```{r}
# calculate wald chi-square value
composite_gender_wald_test = waldtest(composite_gender_model_compact,
                                    composite_gender_model_aug)

print(composite_gender_wald_test)
```

```{r}
# check for interaction between gender and age
composite_gender_int_model_aug = polr(composite_score ~ child_gender*exact_age,
                           data = study5_data,
                           Hess = TRUE)

composite_gender_int_model_compact = polr(composite_score ~ child_gender + exact_age,
                           data = study5_data)
```

```{r}
# calculate wald chi-square value
composite_gender_int_wald_test = waldtest(composite_gender_int_model_compact,
                                    composite_gender_int_model_aug)

print(composite_gender_int_wald_test)
```

#### Character Order

```{r}
# check for main effect of character order (composite measure)
composite_char_order_model_aug = polr(composite_score ~ Condition,
                           data = study5_data,
                           Hess = TRUE)

composite_char_order_model_compact = polr(composite_score ~ 1,
                           data = study5_data)
```

```{r}
# calculate wald chi-square value
composite_char_order_wald_test = waldtest(composite_char_order_model_compact,
                                    composite_char_order_model_aug)

print(composite_char_order_wald_test)
```

```{r}
# check for interaction between age and character order (composite measure)
composite_char_order_model_int_aug = polr(composite_score ~ Condition * exact_age,
                           data = study5_data,
                           Hess = TRUE)

composite_char_order_model_int_compact = polr(composite_score ~ Condition + exact_age,
                           data = study5_data)
```

```{r}
# calculate wald chi-square value
composite_char_order_int_wald_test = waldtest(composite_char_order_model_int_compact,
                                    composite_char_order_model_int_aug)

print(composite_char_order_int_wald_test)
```

#### Study Order

```{r}
# check for main effect of study order (composite measure)
composite_order_model_aug = polr(composite_score ~ study_order_first,
                           data = df.study_order_binary)

composite_order_model_compact = polr(composite_score ~ 1,
                           data = df.study_order_binary)
```

```{r}
# calculate wald chi-square value
composite_order_wald_test = waldtest(composite_order_model_compact,
                                    composite_order_model_aug)

print(composite_order_wald_test)
```

```{r}
# check for interaction between age and study order (composite measure)
composite_order_model_int_aug = polr(composite_score ~ study_order_first * exact_age,
                           data = df.study_order_binary)

composite_order_model_int_compact = polr(composite_score ~ study_order_first + exact_age,
                           data = df.study_order_binary)
```

```{r}
# calculate wald chi-square value
composite_order_int_wald_test = waldtest(composite_order_model_int_compact,
                                    composite_order_model_int_aug)

print(composite_order_int_wald_test)
```

## Figures

### Figure S1

```{r}
# data wrangling for predicted probability plot (Study 3)
df.psh_logit_model = ggpredict(model = psh_logit_model,
                               terms = "Age_Ex [all]")

# for individual data points
df.psh_data = psh_data %>% 
  select(c(Sub_ID, Age_Ex, WhoAsked)) %>% 
  mutate(WhoAsked = ifelse(WhoAsked == "Intrinsic", 0, 1),
         WhoAsked_label = ifelse(WhoAsked == 0, 
                                 "Intrinsic", 
                                 "Reputational"))

df.psh_data = df.psh_data %>% 
  mutate(WhoAsked_label = factor(WhoAsked_label, 
                                 levels = c("Reputational", "Intrinsic"),
                                 labels = c("Reputational", "Intrinsic")))
```

```{r}
# text labels for plot
text_reputational = textGrob("Chose Student with\n Reputational Concerns", 
                              gp=gpar(fontsize=8, 
                                      fontface="bold"))
text_intrinsic = textGrob("Chose Student with\nIntrinsic Concerns", 
                           gp=gpar(fontsize=8, 
                                   fontface="bold"))
```

```{r}
# generate plot
df.psh_logit_model %>% 
  ggplot(mapping = aes(x = x,
                       y = predicted)) +
  geom_ribbon(data = df.psh_logit_model,
              mapping = aes(ymin = conf.low,
                            ymax = conf.high),
              linetype = 0,
              alpha = 0.3) + 
  geom_line(na.rm = TRUE) + 
  geom_point(data = df.psh_data,
             mapping = aes(x = Age_Ex,
                           y = WhoAsked,
                           color = as.factor(WhoAsked_label))) + 
  annotation_custom(text_reputational,
                    xmin=10.95,
                    xmax=10.95,
                    ymin=1,
                    ymax=1) + 
  annotation_custom(text_intrinsic,
                    xmin=10.95,
                    xmax=10.95,
                    ymin=0,
                    ymax=0) + 
  scale_x_continuous(breaks = seq(4, 10, by = 1),
                     expand = c(.01, .01)) + 
  scale_y_continuous(breaks = seq(0, 1.00, by = .25),
                     expand = c(.01, .01)) + 
  scale_color_brewer(palette = "Set1") +
  labs(x = "Age (Continous)",
       y = "Predicted Probability of Choosing Student \n with Reputational Motives",
       fill = element_blank(),
       color = element_blank()) +
  theme(text = element_text(size = 15,
                            family = "Times New Roman",
                            color = "black")) + 
  coord_cartesian(xlim = c(4, 10),
                  ylim = c(0, 1),
                  clip = "off") +
  theme_bw()
```


# References
